{"remainingRequest":"/Users/yokoyamakenta/Desktop/choco_mart/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/yokoyamakenta/Desktop/choco_mart/src/components/sell.vue?vue&type=style&index=0&lang=scss&","dependencies":[{"path":"/Users/yokoyamakenta/Desktop/choco_mart/src/components/sell.vue","mtime":1581237724529},{"path":"/Users/yokoyamakenta/Desktop/choco_mart/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yokoyamakenta/Desktop/choco_mart/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/yokoyamakenta/Desktop/choco_mart/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/yokoyamakenta/Desktop/choco_mart/node_modules/sass-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yokoyamakenta/Desktop/choco_mart/node_modules/vuetify-loader/lib/loader.js","mtime":1574476662000},{"path":"/Users/yokoyamakenta/Desktop/choco_mart/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yokoyamakenta/Desktop/choco_mart/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCiRiYXNlX2NvbG9yXzE6ICNGRkVBQzg7CiRiYXNlX2NvbG9yXzI6ICNCMUEzQTc7CiRiYXNlX2NvbG9yXzM6ICNFMUNBQkI7CiRiYXNlX2NvbG9yXzQ6ICMxRTJFNTg7Ci5zZWxsewogIC5pdGVtLXRoLWNob2NvewogICAgdGh7CiAgICAgICY6Zmlyc3Qtb2YtdHlwZXsKICAgICAgICAvLyB3aWR0aDogNDBweDsKICAgICAgfQogICAgICAmOm50aC1vZi10eXBlKDMpewogICAgICB9CiAgICAgICY6bGFzdC1vZi10eXBlewogICAgICAgIHdpZHRoOiA0MHB4OwogICAgICB9CiAgICB9CiAgfQogIC5pdGVtLXR5cGUtY2hvY297CiAgICAmPmJ1dHRvbnsKICAgICAgLy8gd2lkdGg6IDQ1cHg7CiAgICAgIC8vIG1pbi13aWR0aDogNDVweCAhaW1wb3J0YW50OwogICAgfQogIH0KICAuaXRlbS1pbnB1dC1jaG9jb3sKICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsKICAgIGJvcmRlci1yYWRpdXM6IDZweDsKICAgIGJhY2tncm91bmQ6ICRiYXNlX2NvbG9yXzI7CiAgICB3aWR0aDogMTAwJTsKICAgIGhlaWdodDogNDBweDsKICAgIGZvbnQtc2l6ZTogMTRweDsKICAgIHdoaXRlLXNwYWNlOiBub3dyYXA7CiAgICBpbnB1dCxzcGFuewogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICB3aWR0aDogMTAwJTsKICAgICAgaGVpZ2h0OiA0MHB4OwogICAgICBwYWRkaW5nOiA1cHg7CiAgICAgIHBhZGRpbmctbGVmdDogMTBweDsKICAgICAgYmFja2dyb3VuZC1jb2xvcjogJGJhc2VfY29sb3JfMzsKICAgICAgYm9yZGVyLXJhZGl1czogNXB4OwogICAgfQogIH0KfQo="},{"version":3,"sources":["sell.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiYA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"sell.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div class=\"table-choco sell\">\n    <table class=\"item-table-choco back-choco pa-1\" cellspacing=\"5\">\n      <thead>\n        <tr class=\"item-th-choco text-choco body-2\">\n          <th>ステータス</th>\n          <th>装備名</th>\n          <th>価格</th>\n          <th>返</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr v-for=\"(item,index) in items\" :key=\"index\" class=\"item-td-choco text-choco\">\n          <td class=\"item-choco\">\n            <div class=\"item-type-choco\">\n              <v-btn color=\"#487DF6\" dark @click=\"setStatus(index,item)\" class=\"button-choco\" :class=\"{'danger': item.status == 2}\">\n                <span>{{STATUS[2][item.status]}}</span>\n              </v-btn>\n            </div>\n          </td>\n          <td>\n            <div class=\"item-input-choco\">\n              <template v-if=\"item.status == 1\">\n                <input type=\"text\" class=\"text-choco-dark\" v-model=\"item.name\">\n              </template>\n              <template v-else>\n                <span class=\"text-choco-dark\">\n                  <template v-if=\"$vuetify.breakpoint.xs\">\n                    {{trimText(item.name,12)}}\n                  </template>\n                  <template v-else>\n                    {{trimText(item.name,30)}}\n                  </template>\n                </span>\n              </template>\n            </div>\n          </td>\n          <td>\n            <div class=\"item-input-choco\">\n              <template v-if=\"item.status == 1\">\n                <input type=\"text\" class=\"text-choco-dark\" v-model=\"item.price\" maxlength=\"10\">\n              </template>\n              <template v-else>\n                <span class=\"text-choco-dark pointer\" maxlength=\"10\" @click=\"changePrice(item,index)\">{{trimText(item.price,5)}}</span>\n              </template>\n            </div>\n          </td>\n          <td>\n            <div class=\"item-input-choco\">\n              <template v-if=\"item.status == 1\">\n                <span class=\"text-choco-dark\">-</span>\n              </template>\n              <template v-else>\n                <span class=\"text-choco-dark link pointer\" @click=\"$emit('showReply', item.id,'lists')\">{{item.reply}}</span>\n              </template>\n            </div>\n          </td>\n        </tr>\n      </tbody>\n    </table>\n    <v-row justify=\"center\">\n      <v-dialog\n        v-model=\"dialog.isShow\"\n        max-width=\"500\"\n        width=\"90%\"\n      >\n        <div class=\"modal-choco\">\n          <div class=\"head text-choco pl-2 body-2\">\n            {{dialog.title}}\n          </div>\n          <div class=\"body text-choco-dark pa-2\">\n            <p v-html=\"dialog.content\"></p>\n          </div>\n          <div class=\"footer\">\n            <v-btn v-if=\"dialog.button.positive.isShow\" color=\"#487DF6\" class=\"button-choco\" :class=\"{'pointer-none': dialog.button.positive.isClicked}\" dark @click=\"dialog.button.positive.func()\">\n              <span>OK</span>\n            </v-btn>\n            <v-btn v-if=\"dialog.button.negative.isShow\" color=\"#487DF6\" class=\"button-choco\" dark @click=\"dialog.button.negative.func()\">\n              <span>キャンセル</span>\n            </v-btn>\n          </div>\n        </div>\n      </v-dialog>\n    </v-row>\n  </div>\n</template>\n\n<script>\nimport { mapState, mapGetters, mapMutations, mapActions } from 'vuex'\nimport firebase from 'firebase'\nimport firebaseConfig from '@/plugins/firebase'\n\nexport default {\n  data () {\n    return {\n      dialog: {\n        isShow: false,\n        title: \"\",\n        content: \"\",\n        button: {\n          positive: {\n            isShow: false,\n            isClicked: false,\n            func(){\n\n            }\n          },\n          negative: {\n            isShow: false,\n            func(){\n\n            }\n          }\n        },\n      },\n      count: 0,\n      items: {}\n    }\n  },\n  methods: {\n    setStatus(index,item){\n      switch(item.status){\n        case(1): {\n          this.dialog.title = \"notice\"\n          if(this.is_empty(item.name) || this.is_empty(item.price)){\n            this.dialog.content = `\n            <p>出品する装備名、価格を正しく入力してください。</p>\n            `\n            // <div class=\"text-center\">\n            //   <img src=\"${require('@/assets/imgs/berude.png')}\" height=\"100px\">\n            // </div>\n            this.dialog.button.positive.isShow = false\n            this.dialog.button.negative.isShow = true\n            this.dialog.button.negative.func = () => {\n              this.dialog.isShow = false\n            }\n          }else{\n            this.dialog.content = `【${item.name}】を${item.price}<br>で出品します。よろしいですか?`\n            this.dialog.button.positive.isShow = true\n            this.dialog.button.negative.isShow = true\n\n            let itemId = this.db.collection(\"lists\").doc().id\n\n            let now = firebase.firestore.FieldValue.serverTimestamp()\n            let today = Math.floor( new Date().getTime() / 1000 )\n\n            let sellRef = this.db.collection(\"sells\").doc(this.user.uid)\n            let listRef = this.db.collection(\"lists\").doc(itemId)\n            let msgRef = this.db.collection(\"comments\").doc(itemId)\n\n            this.dialog.button.positive.func = async () => {\n              this.dialog.button.positive.isClicked = true\n\n              // 商品データ\n              let itemData = {\n                id: itemId,\n                uid: this.user.uid,\n                status: 2,\n                name: item.name,\n                price: item.price,\n                type: 2,\n                reply: 1,\n                updated_at: now,\n                created_at: now\n              }\n              // コメント構造\n              let msgData = {\n                item: listRef,\n                reply: [\n                  {\n                    uid: this.user.uid,\n                    msg: \"取引を開始しました。\",\n                    created_at: today\n                  }\n                ],\n                good: 0,\n                created_at: now,\n                updated_at: now\n              }\n\n              this.items[index] = {\n                id: itemId,\n                status: 2,\n                name: item.name,\n                price: item.price,\n                reply: 1,\n              }\n\n              // 販売リスト更新(個人)\n              await sellRef.update({\n                ['items.' + index]: listRef\n              })\n              // 販売リスト更新(全体)\n              await listRef.set({ ...itemData })\n              // スレッド作成\n              await msgRef.set({ ...msgData })\n              // リスナー登録\n              this.setListListener(itemId)\n              this.dialog.isShow = false\n\n              this.dialog.button.positive.isClicked = false\n            }\n            this.dialog.button.negative.func = () => {\n              this.dialog.isShow = false\n            }\n          }\n          this.dialog.isShow = true\n          break\n        }\n\n        case(2): {\n          this.dialog.title = \"notice\"\n          this.dialog.content = `【${item.name}】の取引を締め切ります。<br>よろしいですか?`\n          this.dialog.button.positive.isShow = true\n          this.dialog.button.negative.isShow = true\n\n          let now = firebase.firestore.FieldValue.serverTimestamp()\n          let today = Math.floor( new Date().getTime() / 1000 )\n\n          let sellRef = this.db.collection(\"sells\").doc(this.user.uid)\n          let listRef = this.db.collection(\"lists\").doc(item.id)\n          let msgRef = this.db.collection(\"comments\").doc(item.id)\n\n          this.dialog.button.positive.func = async () => {\n            this.dialog.button.positive.isClicked = true\n\n            // 商品データ\n            let itemData = {\n              reply: firebase.firestore.FieldValue.increment(1),\n              status: 3,\n              updated_at: now\n            }\n            // コメント構造\n            let msgData = {\n              uid: this.user.uid,\n              msg: \"取引を締め切りました。\",\n              created_at: Math.floor( new Date().getTime() / 1000 )\n            }\n            // 販売リスト更新(個人)\n            await sellRef.update({\n              ['items.' + index]: firebase.firestore.FieldValue.delete()\n            })\n            // 販売リスト更新(全体)\n            await listRef.update({\n              ...itemData \n            })\n            // チャット更新\n            await msgRef.update({\n              reply: firebase.firestore.FieldValue.arrayUnion(msgData)\n            });\n            // 出品枠を空に\n            this.$set(this.items, index, {\n              id: \"\",\n              status: 1,\n              name: \"\",\n              price: \"\",\n              reply: 0\n            })\n\n            this.dialog.isShow = false\n            this.dialog.button.positive.isClicked = false\n          }\n          this.dialog.button.negative.func = () => {\n            this.dialog.isShow = false\n          }\n\n          this.dialog.isShow = true\n          break\n        }\n\n        default:\n          break\n      }\n    },\n    changePrice(item,index){\n      this.dialog.title = \"notice\"\n      this.dialog.content = `\n        <p>変更後の価格を入力してください。</p>\n        <div class=\"item-input-choco\">\n          <input type=\"text\" id=\"newPrice\" class=\"text-choco-dark\" value=${item.price} maxlength=\"10\">\n        </div>\n      `\n      this.dialog.button.positive.isShow = true\n      this.dialog.button.negative.isShow = true\n      this.dialog.button.positive.func = async () => {\n        let newPrice = document.getElementById('newPrice').value\n        if(newPrice != item.price){\n          this.dialog.button.positive.isClicked = true\n          await this.setPrice(item,index,newPrice)\n          this.dialog.isShow = false\n          this.dialog.button.positive.isClicked = false\n        }else{\n          return\n        }\n      }\n      this.dialog.button.negative.func = () => {\n        this.dialog.isShow = false\n      }\n      this.dialog.isShow = true\n    },\n    async setPrice(item,index,newPrice){\n      let listRef = this.db.collection(\"lists\").doc(item.id)\n      let msgRef = this.db.collection(\"comments\").doc(item.id)\n\n      let now = firebase.firestore.FieldValue.serverTimestamp()\n      let itemData = {\n        price: newPrice,\n        updated_at: now,\n        reply: firebase.firestore.FieldValue.increment(1)\n      }\n\n      let msgData = {\n        uid: this.user.uid,\n        msg: `価格の変更を行いました。<br>${item.price} → 【${newPrice}】`,\n        created_at: Math.floor( new Date().getTime() / 1000 )\n      }\n      // 販売リスト更新(全体)\n      await listRef.update({\n         ...itemData \n      })\n      // 値段変更通知\n      await msgRef.update({\n        reply: firebase.firestore.FieldValue.arrayUnion(msgData)\n      });\n      this.dialog.isShow = false\n    },\n    async refresh(){\n      // await firebaseConfig.onAuth()\n      let data = await this.RefreshSellList()\n      // 初期化\n      for(let i=1; i<=data.count; i++){\n        this.$set(this.items, i, {\n          id: \"\",\n          status: 1,\n          name: \"\",\n          price: \"\",\n          reply: 0\n        })\n      }\n      // 更新\n      if(data.items){\n        for(let index in data.items){\n          let itemRef = await firebase.firestore().collection(\"lists\").doc(data.items[index].id)\n          let itemData = await itemRef.get()\n          this.items[index] = {\n            id: itemData.data().id,\n            status: itemData.data().status,\n            name: itemData.data().name,\n            price: itemData.data().price,\n            reply: itemData.data().reply,\n          }\n          this.setListListener(itemData.data().id)\n        }\n      }\n    },\n    setListListener(id){\n      let t = this\n      firebase.firestore().collection(\"lists\").doc(id).onSnapshot(function (querySnapshot) {\n        let updatedData = querySnapshot.data()\n        for(let index in t.items) {\n          if(t.items[index].id == updatedData.id){\n            t.items[index] = {\n              id: updatedData.id,\n              status: updatedData.status,\n              name: updatedData.name,\n              price: updatedData.price,\n              reply: updatedData.reply,\n            }\n          }\n        }\n      })\n    }\n  },\n  computed: {\n    ...mapGetters({\n      user: 'auth/user',\n    }),\n  },\n  async mounted(){\n    await this.refresh()\n  }\n}\n</script>\n\n<style lang=\"scss\">\n$base_color_1: #FFEAC8;\n$base_color_2: #B1A3A7;\n$base_color_3: #E1CABB;\n$base_color_4: #1E2E58;\n.sell{\n  .item-th-choco{\n    th{\n      &:first-of-type{\n        // width: 40px;\n      }\n      &:nth-of-type(3){\n      }\n      &:last-of-type{\n        width: 40px;\n      }\n    }\n  }\n  .item-type-choco{\n    &>button{\n      // width: 45px;\n      // min-width: 45px !important;\n    }\n  }\n  .item-input-choco{\n    display: inline-block;\n    border-radius: 6px;\n    background: $base_color_2;\n    width: 100%;\n    height: 40px;\n    font-size: 14px;\n    white-space: nowrap;\n    input,span{\n      display: flex;\n      align-items: center;\n      width: 100%;\n      height: 40px;\n      padding: 5px;\n      padding-left: 10px;\n      background-color: $base_color_3;\n      border-radius: 5px;\n    }\n  }\n}\n</style>"]}]}